# 3.3 트랜잭션

# 3.3.1 트랜잭션

트랜잭션: 데이터베이스의 상태를 바꾸기 위해 수행하는 작업의 단위 또는 일련의 연산

트랜잭션의 특징 ACID

- 원자성(Atomicity): 트랜잭션이 데이터베이스에 완전히 반영되거나 아예 실행되지 않아야 한다.
- 일관성(Consistency): 트랜잭션이 수행이 완료된 데이터베이스는 일관성이 있다.
- 독립성(Isolation): 수행 중인 트랜잭션에 다른 트랜잭션이 끼어들 수 없다.
- 영속성(Durability): 완료한 트랜잭션의 결과가 데이터베이스에 영구적으로 반영된다.

트랜잭션을 제어하기 위해 TCL(Transaction Control Language)라는 명령어를 사용한다.

TCL 종류

- COMMIT: 트랜잭션이 정상적으로 종료되어 데이터베이스에 변경 사항을 반영하는 명령어다.
- ROLLBACK: 트랜잭션이 비정상적으로 종료되어 트랜잭션이 수행한 변경 사항을 취소하고 데이터베이스를 이전 상태로 되돌리는 명령어다.
- SAVEPOINT: 트랜잭션에서 특정 지점을 지정하는 명령어로, ROLLBACK과 함께 사용하면 해당 지점까지 되돌릴 수 있다.

# 3.3.2 락

락(lock): 트랜잭션이 처리되는 순서를 보장하기 위한 방법이다.

락의 종류

- 공유 락(shared lock): 데이터를 읽는 락으로 읽기 락(read lock)이라고 한다. 데이터를 읽는 연산이므로 데이터의 일관성에 영향을 주지 않아 데이터에 여러 공유 락이 동시에 접근할 수 있다.
- 베타 락(exclusive lock): 데이터를 수정하는 락으로 쓰기 락(write lock)이라고 한다. 데이터의 일관성을 유지하기 위해 데이터에 하나의 베타 락이 접근 중일 때 다른 베타 락이 접근할 수 없다.

데이터베이스도 교착 상태에 빠질 수 있으니 주의.

교착 상태를 해결하기 위한 방법

1. 예방 기법
    
    트랜잭션 처리가 시작되기 전 필요한 데이터에 대해 미리 락을 얻는 방식
    
2. 회피 기법
    
    트랜잭션이 들어온 순서에 따라 교착 상태를 회피하는 방식.
    
    - wait-die: 데이터의 락을 요청하려는 트랜잭션이 해당 데이터에 대해 이미 락을 갖고 있는 트랜잭션보다 오래되었다면 락을 얻을 때까지 기다린다. 반면, 락을 갖고 있는 트랜잭션보다 최신이라면 락 획득을 포기한다.
    - wound-wait: 데이터의 락을 요청하려는 트랜잭션이 해당 데이터에 대해 이미 락을 갖고 있는 트랜잭션보다 오래되었다면 락을 빼앗는다. 반면, 락을 갖고 있는 트랜잭션보다 최신이라면 락 획득을 기다린다.

# 3.3.3 이상

이상(anomaly): 트랜잭션을 처리하는 중에 속성 간 종속이나 데이터 중복으로 발생하는 문제

- 삽입 이상(insertion anomaly): 데이터 삽입 시 의도치 않은 다른 데이터도 삽입됨.
- 갱신 이상(update anomaly): 데이터 갱신 시 일부 튜플만 갱신되어 데이터 모순이 발생함.
- 삭제 이상(deletion anomaly): 데이터 삭제 시 의도하지 않은 데이터도 삭제됨.

# 3.3.4 정규화

정규화(normalization): 데이터베이스의 이상 현상을 해결하기 위해 테이블을 분해하는 것.

- 테이블을 분해하느라 연산 시간이 증가한다는 단점이 있음.

정규형: 정규화한 결과

## 제1정규형

제1정규형(1NF, First Normal Form): 테이블의 모든 속성 값이 더 이상 분해될 수 없는 값. 원자 값.

## 제2정규형

제2정규형(2NF, Second Normal Form): 제1정규형에 속하는 테이블에서 부분적 함수 종속을 제거해 완전 함수 종속을 만족함.

함수 종속성: 테이블에서 속성 간 종속 관계를 의미

결정자, 종속자. A속성이 B 속성을 결정하면 B 속성이 A 속성에 함수 종속된다. A가 결정자, B가 종속자.

완전 함수 종속: A 속성이 B 속성을 결정하지만, A 속성의 진부분집합이 B 속성을 결정하지 않는 경우. 

부분적 함수 종속: 기본 키의 부분집합이 결정자가 될 수 있음을 의미. 기본 키의 진부분집합이 결정자가 될 수 없도록 테이블을 분해해야 완전 함수 종속을 만족.

## 제3정규형

제3정규형(3NF, Third Normal Form): 제2정규형에 속하는 테이블에서 이행적 종속이 없어야 함.

이행적 종속: A속성이 B 속성을 결정하고 B 속성이 C 속성을 결정할 때 A 속성이 C 속성을 결정하는 것을 의미함.

## 보이스-코드 정규형

보이스-코드 정규형(BCNF, Boyce-Codd Normal Form): 제 3정규형에 속하는 테이블의 모든 결정자가 후보 키가 되도록 테이블을 분해해야 함.
